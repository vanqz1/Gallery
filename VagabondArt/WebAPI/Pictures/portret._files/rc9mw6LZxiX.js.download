if (self.CavalryLogger) { CavalryLogger.start_js(["9UUoA"]); }

__d('NotificationCounter',['Arbiter','DocumentTitle','JSLogger'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={messages:0,notifications:0,requests:0},i={init:function j(){c('Arbiter').subscribe('update_title',this._handleUpdate.bind(this));c('Arbiter').subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function j(){var k=0;for(var l in h){var m=Number(h[l]);if(typeof h[l]=='string'&&isNaN(m))return h[l];if(isNaN(m)||m<0){c('JSLogger').create('jewels').error('bad_count',{jewel:l,count:h[l]});continue;}k+=m;}return k;},updateTitle:function j(){var k=this.getCount(),l=c('DocumentTitle').get();l=k?'('+k+') '+l:l;c('DocumentTitle').set(l,true);},_handleCountUpdate:function j(k,l){h[l.jewel]=l.count;this.updateTitle();},_handleUpdate:function j(k,l){this.updateTitle();}};f.exports=i;}),null);
__d("XNotificationsSyncController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/sync\/",{lastSync:{type:"Int",required:true}});}),null);
__d('NotificationSync',['Arbiter','AsyncRequest','ChannelConstants','JSLogger','NotificationConstants','NotificationUpdates','XNotificationsSyncController'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('JSLogger').create('notifications'),i='channel_reload',j=0;function k(p){var q=c('NotificationUpdates').getserverTime()?c('NotificationUpdates').getserverTime():j,r=c('XNotificationsSyncController').getURIBuilder().setInt('lastSync',q).getURI();p.setHandler(l).setOption('suppressErrorAlerts',true).setErrorHandler(m).setMethod('GET').setReadOnly(true).setURI(r).setAllowCrossPageTransition(true);}function l(p){var q=p.getPayload();if(q.syncPayload)c('NotificationUpdates').handleUpdate(c('NotificationConstants').PayloadSourceType.SYNC,q.syncPayload);}function m(p){}function n(){var p=new (c('AsyncRequest'))();p.setIsBackgroundRequest(true);k(p);p.send();h.bump(i);}var o={setup:function p(q){j=q;c('Arbiter').subscribe(c('ChannelConstants').ON_INVALID_HISTORY,n);}};f.exports=o;}),null);
__d('NotificationJewelController',['Arbiter','Bootloader','Event','NotificationConstants','NotificationCounter','NotificationSeenState','NotificationStore','NotificationSync','NotificationUpdates','FunnelLogger','NotificationJewelFunnelLoggingConstants','createObjectFrom','curry','isInFocusMode'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('NotificationJewelFunnelLoggingConstants').FUNNEL_LOGGING_NAME,i=c('NotificationJewelFunnelLoggingConstants').FUNNEL_LOGGING_EVENT,j=0;function k(m){var n=c('isInFocusMode')();c('Arbiter').inform('jewel/count-updated',{jewel:m,count:n?0:c('NotificationSeenState').getUnseenIDs().length},c('Arbiter').BEHAVIOR_STATE);}function l(m,n,o,p,q){'use strict';var r=null;if(n.list&&n.unseenNotifs&&n.startTime){r=n.list;o=n.unseenNotifs;p=n.startTime;}else r=n;q=q||n.endPoint;if(q)c('NotificationStore').registerEndpoint(q);c('NotificationCounter').init();var s=c('Event').listen(m.getRoot(),'mouseover',function(){c('FunnelLogger').startFunnel(h);s.remove();s=null;r.open();c('FunnelLogger').appendAction(h,i.MOUSE_OVER_ON_JEWEL);});if(m.isOpen()){r.open();}else var t=m.subscribe('opened',function(){t.unsubscribe();t=null;r.open();});var u=r.pause.bind(r);m.subscribe('opened',function(){setTimeout(u,0);k(m.name);c('Bootloader').loadModules(["NotificationVPVs"],function(v){return v.clearImpressions();},'NotificationJewelController');});m.subscribe('closed',function(){r.unpause();k(m.name);});c('NotificationUpdates').subscribe('seen-state-updated',c('curry')(k,m.name));c('NotificationUpdates').handleUpdate(c('NotificationConstants').PayloadSourceType.INITIAL_LOAD,{seenState:c('createObjectFrom')(o,j)});c('NotificationSync').setup(p);k(m.name);c('NotificationUpdates').setEndPoint(q);}f.exports=l;}),null);
__d('NotificationJewelReminder',['cx','fbt','Arbiter','DOMQuery','Image.react','ImageBlock.react','LayerFadeOnHide','LayerFadeOnShow','NotificationStore','NotificationUpdates','React','ReactDOM','Toggler','WorkFocusModeController','XUIContextualDialog.react','ge','ifRequired','injectSubscriptionsHandler.react','intlList','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('WorkFocusModeController').WorkFocusMode,m=2,n='fbRequestsJewel',o='fbNotificationsJewel';j=babelHelpers.inherits(p,c('React').Component);k=j&&j.prototype;function p(s){'use strict';k.constructor.call(this,s);this.$JewelReminderDialogImpl2=function(){this.setState({shown:false},function(){this.props.onHide&&this.props.onHide();}.bind(this));}.bind(this);this.$JewelReminderDialogImpl3=function(){clearTimeout(this.$JewelReminderDialogImpl1);}.bind(this);this.$JewelReminderDialogImpl4=function(){this.$JewelReminderDialogImpl3();}.bind(this);this.$JewelReminderDialogImpl5=function(){this.$JewelReminderDialogImpl2();}.bind(this);this.$JewelReminderDialogImpl6=function(t){this.$JewelReminderDialogImpl2();this.props.onClick&&this.props.onClick(t);}.bind(this);this.state={shown:true};}p.prototype.componentWillMount=function(){'use strict';this.$JewelReminderDialogImpl1=c('setTimeoutAcrossTransitions')(this.$JewelReminderDialogImpl2,this.props.showTime);this.props.subscriptionsHandler.addSubscriptions(c('Arbiter').subscribe('layer_shown',function(s,t){if(t&&t.type==='Jewel')this.$JewelReminderDialogImpl2();}.bind(this)));};p.prototype.componentWillUnmount=function(){'use strict';this.$JewelReminderDialogImpl3();};p.prototype.$JewelReminderDialogImpl7=function(){'use strict';var s=this.props,t=s.names,u=s.jewelType,v=s.unreadCount,w=t.map(function(x){return c('React').createElement('b',null,x);});if(u==='notification')return i._({"*":{"notifications":"{number} \u0438\u0437\u0432\u0435\u0441\u0442\u0438\u044f \u043e\u0442 {notification senders}","notification":"{number} notification from {notification senders}"}},[i.param('number',v,[0]),i['enum'](v>1?'notifications':'notification',{notifications:'notifications',notification:'notification'}),i.param('notification senders',c('intlList')(w))]);return i._({"*":{"requests":"{number} friend requests from {request senders}","request":"{number} friend request from {request senders}"}},[i.param('number',v,[0]),i['enum'](v>1?'requests':'request',{requests:'requests',request:'request'}),i.param('request senders',c('intlList')(w))]);};p.prototype.render=function(){'use strict';var s=this.props,t=s.context,u=s.photoURI;return (c('React').createElement(c('XUIContextualDialog.react'),{context:t,shown:this.state.shown,offsetY:-10,position:'below',alignment:'right',behaviors:{LayerFadeOnShow:c('LayerFadeOnShow'),LayerFadeOnHide:c('LayerFadeOnHide')},width:210},c('React').createElement('div',{onMouseEnter:this.$JewelReminderDialogImpl4,onMouseLeave:this.$JewelReminderDialogImpl5,onClick:this.$JewelReminderDialogImpl6,className:"_5bov"},c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(c('Image.react'),{className:"_5bow",src:u}),c('React').createElement('div',null,this.$JewelReminderDialogImpl7())))));};var q=c('injectSubscriptionsHandler.react')(p);function r(s){'use strict';if(s.request.count>0&&s.show_request){this.$NotificationJewelReminder2(s.request,s.show_notif,s.show_time);}else this.$NotificationJewelReminder3(s.show_notif,s.show_time);}r.prototype.$NotificationJewelReminder4=function(s){'use strict';return s!=null&&!c('Toggler').getInstance(s).isShown();};r.prototype.$NotificationJewelReminder2=function(s,t,u){'use strict';this.$NotificationJewelReminder5(s.pics[0],s.names,s.count,n,u,function(){return this.$NotificationJewelReminder3(t,u);}.bind(this));};r.prototype.$NotificationJewelReminder3=function(s,t){'use strict';var u=l&&l.currentViewerInFocusMode();if(u||!s)return;this.$NotificationJewelReminder1=c('NotificationUpdates').subscribe('update-notifications',function(v,w){var x=w.nodes;if(x)this.$NotificationJewelReminder6(x,t);}.bind(this));c('NotificationStore').getNotifications(Number.isInteger(s)?s:0,function(v){return this.$NotificationJewelReminder6(v,t);}.bind(this));};r.prototype.$NotificationJewelReminder6=function(s,t){'use strict';if(this.$NotificationJewelReminder1){this.$NotificationJewelReminder1.unsubscribe();this.$NotificationJewelReminder1=null;}var u=[],v=void 0;s=s.filter(function(z){return z.seen_state==='UNSEEN_AND_UNREAD';});for(var w=0;w<s.length;w++){if(!s[w].showBeep)continue;var x=s[w].actors;if(x.length===0)continue;for(var y=0;y<x.length;y++){v=v||x[y].profile_picture.uri;if(u.length<m&&x[y].name&&u.indexOf(x[y].name)===-1)u.push(x[y].name);}if(u.length===m)break;}if(u.length===0||!v)return;this.$NotificationJewelReminder5(v,u,s.length,o,t);};r.prototype.$NotificationJewelReminder5=function(s,t,u,v,w,x){'use strict';var y=c('ge')(v);if(!this.$NotificationJewelReminder4(y))return;c('ReactDOM').render(c('React').createElement(q,{showTime:w,context:c('DOMQuery').scry(y,'.jewelButton')[0],names:t,photoURI:s,unreadCount:u,jewelType:v===o?'notification':'request',onClick:function z(){c('Toggler').show(y);c('ifRequired')('ClientChromeStore',function(aa){aa.dispatch({type:'UPDATE_ACTIVE_FLYOUT',data:v===o?'notification':'request'});});},onHide:x}),document.createElement('div'));};f.exports=r;}),null);